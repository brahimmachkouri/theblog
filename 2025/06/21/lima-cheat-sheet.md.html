<p>aul—
layout: post
date: 2025-06-21 12:30:00
title: Lima - Ubuntu cheat sheet
category: système
tags: virtualisation macos
—</p>

<p><img src="https://raw.githubusercontent.com/brahimmachkouri/theblog/main/assets/images/lima2.png" alt="lima" /></p>

<p>Lima (“<strong>Li</strong>nux virtual <strong>ma</strong>chines”) est un outil open-source qui permet de lancer facilement des machines virtuelles Linux sur macOS (et aussi Linux). Il vise à offrir une expérience “Linux-on-Mac” fluide pour les développeurs, tout en gardant une gestion simple et intégrée.</p>

<p>L’objectif est d’exécuter des outils Linux (Docker, Podman, Kubernetes, etc.) sur Mac dans un vrai environnement Linux, ce qui offre une compatibilité et un comportement identiques à un vrai serveur Linux.</p>

<h2 id="installation">Installation</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>lima
</code></pre></div></div>

<h2 id="-lister-les-templates-ubuntu-disponibles">📦 Lister les templates Ubuntu disponibles</h2>

<p>Il existe de nombreux templates disponibles (docker, podman, kubernetes, ubuntu, debian, fedora, opensuse, alpine, etc), mais ici, c’est Ubuntu qui nous intéresse :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>limactl start <span class="nt">--list-templates</span> | <span class="nb">grep </span>ubuntu
</code></pre></div></div>

<p>✅ Affiche les templates Ubuntu disponibles localement.</p>

<p>✅ Exemples de templates :</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">ubuntu</code> : Dernière LTS (ex: 22.04)</li>
  <li><code class="language-plaintext highlighter-rouge">ubuntu-lts</code> : Alias vers la dernière LTS stable</li>
  <li><code class="language-plaintext highlighter-rouge">ubuntu-20.04</code> : Ubuntu 20.04 LTS (Focal Fossa)</li>
  <li><code class="language-plaintext highlighter-rouge">ubuntu-22.04</code> : Ubuntu 22.04 LTS (Jammy Jellyfish)</li>
  <li><code class="language-plaintext highlighter-rouge">ubuntu-24.04</code> : Ubuntu 24.04 LTS (Noble Numbat)</li>
</ul>

<hr />

<h2 id="-créer-et-démarrer-une-vm-ubuntu-avec-une-version-précise">🚀 Créer et démarrer une VM Ubuntu avec une version précise</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ubuntu LTS actuelle (ex: 22.04)</span>
limactl start <span class="nt">--name</span><span class="o">=</span>ubuntu-lts template://ubuntu-lts

<span class="c"># Ubuntu 20.04 (Focal Fossa) avec 2 CPU et 4 Go de RAM</span>
limactl start <span class="nt">--name</span><span class="o">=</span>ubuntu20 template://ubuntu-20.04 <span class="nt">--cpus</span><span class="o">=</span>2 <span class="nt">--memory</span><span class="o">=</span>4G

<span class="c"># Ubuntu 22.04 (Jammy Jellyfish) en mode Virtualization.framework avec Rosetta</span>
limactl start <span class="nt">--name</span><span class="o">=</span>ubuntu22 template://ubuntu-22.04 <span class="nt">--vm-type</span><span class="o">=</span>vz <span class="nt">--rosetta</span>

<span class="c"># Ubuntu 24.04 (Noble Numbat) : 4 CPU, 8 Go de RAM, Virtualization.framework, Rosetta, montage virtiofs en écriture</span>
limactl start <span class="nt">--name</span><span class="o">=</span>ubuntu24 template://ubuntu-24.04 <span class="nt">--cpus</span><span class="o">=</span>4 <span class="nt">--memory</span><span class="o">=</span>8G <span class="nt">--vm-type</span><span class="o">=</span>vz <span class="nt">--rosetta</span> <span class="nt">--mount-type</span><span class="o">=</span>virtiofs <span class="nt">--mount-writable</span>

<span class="c"># Version non-LTS (ex: 24.10) ou future</span>
limactl start <span class="nt">--name</span><span class="o">=</span>ubuntu-dev template://ubuntu-25.04
</code></pre></div></div>

<p>🛠️ <strong>Paramètres courants :</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">--cpus=</code> : Nombre de CPU alloué à la VM.</li>
  <li><code class="language-plaintext highlighter-rouge">--memory=G</code> : Taille de la mémoire en Go (ex: <code class="language-plaintext highlighter-rouge">8G</code> pour 8 Go).</li>
  <li><code class="language-plaintext highlighter-rouge">--disk=G</code> : Taille du disque en Go (par défaut 100Go).</li>
  <li><code class="language-plaintext highlighter-rouge">--vm-type={qemu, vz}</code> : Type de machine virtuelle (<code class="language-plaintext highlighter-rouge">vz</code> pour macOS Ventura+ utilisant Virtualization.framework, plus performant).</li>
  <li><code class="language-plaintext highlighter-rouge">--rosetta</code> : Active Rosetta pour l’exécution de binaires x86_64 sur Mac Apple Silicon (nécessite <code class="language-plaintext highlighter-rouge">--vm-type=vz</code>).</li>
  <li><code class="language-plaintext highlighter-rouge">--mount-type={9p, virtiofs, reverse-sshfs}</code> : Type de montage (performant : <code class="language-plaintext highlighter-rouge">virtiofs</code> avec <code class="language-plaintext highlighter-rouge">vz</code>).</li>
  <li><code class="language-plaintext highlighter-rouge">--mount-writable</code> : Donne accès en écriture au montage du répertoire de l’hôte.</li>
</ul>

<p>🐚 <strong>Alternative interactive :</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>limactl start
</code></pre></div></div>
<p>➡️ Choisir le template dans l’interface interactive.</p>

<hr />

<h2 id="️-accéder-à-la-vm">🖥️ Accéder à la VM</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Commande standard</span>
limactl shell &lt;nom_vm&gt;

<span class="c"># Exemple :</span>
limactl shell ubuntu24

<span class="c"># Accès SSH avancé (pour scripts)</span>
ssh <span class="nt">-o</span> <span class="nv">IdentitiesOnly</span><span class="o">=</span><span class="nb">yes</span> <span class="nt">-i</span> ~/.lima/_config/user <span class="nt">-p</span> 60022 lima@127.0.0.1
</code></pre></div></div>

<hr />

<h2 id="-gérer-la-vm">🛑 Gérer la VM</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>limactl list                 <span class="c"># Lister toutes les VM</span>
limactl stop         <span class="c"># Arrêter une VM</span>
limactl start        <span class="c"># Démarrer une VM arrêtée</span>
limactl restart      <span class="c"># Redémarrer une VM</span>
limactl delete       <span class="c"># Supprimer une VM (demande confirmation)</span>
</code></pre></div></div>

<p>⚠️ <code class="language-plaintext highlighter-rouge">limactl delete</code> supprime les disques et la configuration de la VM.</p>

<hr />

<h2 id="-copier-des-fichiers-entre-hôte-mac-et-vm">📂 Copier des fichiers entre hôte (Mac) et VM</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lima <span class="nb">cp</span> &lt;<span class="nb">source</span><span class="o">&gt;</span> &lt;destination&gt;
</code></pre></div></div>

<h3 id="depuis-le-mac-vers-la-vm">Depuis le Mac vers la VM</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>limactl <span class="nb">cp</span> ./mon_fichier.txt ubuntu24:~/
</code></pre></div></div>

<h3 id="depuis-la-vm-vers-le-mac">Depuis la VM vers le Mac</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>limactl <span class="nb">cp </span>ubuntu24:~/rapport.pdf ./
</code></pre></div></div>

<h3 id="copier-un-répertoire-récursivement">Copier un répertoire récursivement</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>limactl <span class="nb">cp</span> <span class="nt">-r</span>  :
</code></pre></div></div>

<hr />

<h2 id="️-personnaliser-la-configuration-de-la-vm">⚙️ Personnaliser la configuration de la VM</h2>

<h3 id="editer-la-configuration-post-création">Editer la configuration post-création</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>limactl edit 
</code></pre></div></div>

<p>Exemple (fragment) :</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">cpus</span><span class="pi">:</span> <span class="m">4</span>
<span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">8GiB"</span>
<span class="na">disk</span><span class="pi">:</span> <span class="s2">"</span><span class="s">50GiB"</span>
<span class="na">mounts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s2">"</span><span class="s">~"</span>
    <span class="na">writable</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="c1">#virtiofs: true  # Utiliser pour vz si nécessaire</span>
</code></pre></div></div>

<p>Après modification, arrêter et redémarrer la VM :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>limactl stop 
limactl start 
</code></pre></div></div>

<h3 id="création-avancée-avec-fichier-de-configuration-yaml">Création avancée avec fichier de configuration YAML</h3>
<ol>
  <li>Créez un fichier <code class="language-plaintext highlighter-rouge">config.yaml</code> avec le contenu souhaité :</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">images</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://cloud-images.ubuntu.com/releases/24.04/release/ubuntu-24.04-server-cloudimg-amd64.img"</span>
    <span class="na">arch</span><span class="pi">:</span> <span class="s2">"</span><span class="s">x86_64"</span>
<span class="na">mounts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">location</span><span class="pi">:</span> <span class="s2">"</span><span class="s">~"</span>
    <span class="na">writable</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">cpus</span><span class="pi">:</span> <span class="m">4</span>
<span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">8GiB"</span>
<span class="na">vmType</span><span class="pi">:</span> <span class="s2">"</span><span class="s">vz"</span>
<span class="na">rosetta</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">mountType</span><span class="pi">:</span> <span class="s2">"</span><span class="s">virtiofs"</span>
</code></pre></div></div>

<ol>
  <li>Lancez Lima en spécifiant le fichier de configuration :</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>limactl start <span class="nt">--name</span><span class="o">=</span>ubuntu24-advanced <span class="nt">--file</span> config.yaml
</code></pre></div></div>

<hr />

<h2 id="-vérifier-la-version-ubuntu-dans-la-vm">📝 Vérifier la version Ubuntu dans la VM</h2>

<p>Une fois connecté à la VM :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsb_release <span class="nt">-a</span>
</code></pre></div></div>

<p>Ou :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /etc/os-release
</code></pre></div></div>

<p>Commande depuis le Mac sans se connecter via un shell :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>limactl shell ubuntu24 <span class="nt">--</span> lsb_release <span class="nt">-d</span>
</code></pre></div></div>

<hr />

<h2 id="ℹ️-infos-rapides-sur-les-fichiers-de-la-vm-myubu24">ℹ️ Infos rapides sur les fichiers de la VM “myubu24”</h2>

<p>Supposons qu’une VM avec le nom “myubu24” existe, les fichiers sont dans ~/.lima :</p>

<pre><code class="language-brew">.lima/
├── _config
│   ├── networks.yaml         # Config réseau
│   ├── user                  # Clé privée
│   └── user.pub              # Clé publique
└── myubu24
    ├── basedisk &lt;--- 578 Mo  # Image disque de base (cloudimg) utilisée
    ├── cidata.iso            # Image cloud-init (seed ISO)
    ├── cloud-config.yaml     # Configuration de la VM
    ├── default_ep.sock
    ├── default_fd.sock
    ├── diffdisk &lt;----100 Go  # Overlay du disque (état de la VM)
    ├── ha.pid
    ├── ha.sock
    ├── ha.stderr.log
    ├── ha.stdout.log         # Logs du superviseur/agent VM
    ├── lima-version
    ├── lima.yaml             # Config YAML de la VM
    ├── serialv.log           # Log de la console série
    ├── ssh.config
    ├── ssh.sock
    ├── vz-efi
    ├── vz-identifier
    └── vz.pid
</code></pre>

<h2 id="ℹ️-infos-sur-les-images">ℹ️ Infos sur les images</h2>

<ul>
  <li><strong>Source des images</strong> : Lima utilise les <a href="https://cloud-images.ubuntu.com/">cloud-images Ubuntu</a> au format QCOW2 (KVM/QEMU).</li>
  <li><strong>Mises à jour</strong> : La première fois, l’image est téléchargée puis mise en cache.</li>
  <li><strong>Non conteneur</strong> : Lima fonctionne avec des machines virtuelles complètes (QEMU ou Virtualization.framework), pas des conteneurs LXC.</li>
</ul>

<hr />

<h2 id="-astuces-lima--ubuntu">💡 Astuces Lima + Ubuntu</h2>

<ul>
  <li><strong>Hostname par défaut</strong> : <code class="language-plaintext highlighter-rouge">lima-</code></li>
  <li><strong>Utilisateur par défaut</strong> : <code class="language-plaintext highlighter-rouge">lima</code> (avec accès sudo sans mot de passe)</li>
  <li><strong>Répertoire monté par défaut</strong> : Le répertoire home de l’utilisateur Mac est monté dans <code class="language-plaintext highlighter-rouge">/mnt/lima/home/</code>.</li>
  <li><strong>Accès SSH avancé</strong> : Voir <code class="language-plaintext highlighter-rouge">~/.lima/&lt;nom_vm&gt;/ssh.config</code> pour la configuration SSH complète.</li>
</ul>

<hr />

<h2 id="-liens-utiles">🔗 Liens utiles</h2>

<ul>
  <li><a href="https://lima-vm.io/">Documentation officielle de Lima</a></li>
  <li><a href="https://cloud-images.ubuntu.com/">Liste des images cloud Ubuntu</a></li>
  <li><a href="https://github.com/lima-vm/lima">Github de Lima</a></li>
</ul>

<hr />

<blockquote>
  <p><strong>Résumé workflow :</strong></p>
  <ol>
    <li><code class="language-plaintext highlighter-rouge">limactl start --name=... template://...</code> (avec options)</li>
    <li><code class="language-plaintext highlighter-rouge">limactl shell ...</code> pour se connecter</li>
    <li>Utiliser la VM comme un vrai système Ubuntu</li>
    <li><code class="language-plaintext highlighter-rouge">limactl stop ...</code> pour arrêter</li>
  </ol>
</blockquote>

<blockquote>
  <p><strong>Pro tips :</strong></p>
  <ul>
    <li>Pour les Mac Apple Silicon : toujours privilégier <code class="language-plaintext highlighter-rouge">--vm-type=vz</code> et <code class="language-plaintext highlighter-rouge">--rosetta</code>.</li>
    <li><code class="language-plaintext highlighter-rouge">--mount-type=virtiofs</code> offre les meilleures performances de partage de fichiers.</li>
    <li>Configurer les montages en écriture avec <code class="language-plaintext highlighter-rouge">--mount-writable</code>.</li>
  </ul>
</blockquote>

